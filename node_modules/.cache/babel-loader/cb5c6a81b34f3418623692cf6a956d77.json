{"ast":null,"code":"import _regeneratorRuntime from\"/home/iryna/Desktop/NodeJS-in-AWS-Training/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/iryna/Desktop/NodeJS-in-AWS-Training/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/iryna/Desktop/NodeJS-in-AWS-Training/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{makeStyles}from'@material-ui/core/styles';import Typography from\"@material-ui/core/Typography\";import axios from'axios';var useStyles=makeStyles(function(theme){return{content:{backgroundColor:theme.palette.background.paper,padding:theme.spacing(3,0,3)}};});export default function CSVFileImport(_ref){var url=_ref.url,title=_ref.title;var classes=useStyles();var _useState=useState(),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),uploadUrl=_useState4[0],setUploadUrl=_useState4[1];var createFile=function createFile(file){var reader=new FileReader();reader.onload=function(e){console.log(e.target.result);setFile(e.target.result);};reader.readAsDataURL(file);};var onFileChange=function onFileChange(e){console.log(e);var files=e.target.files||e.dataTransfer.files;if(!files.length)return;createFile(files[0]);};var removeFile=function removeFile(){setFile('');};var uploadFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,binary,array,i,blobData,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'GET',url:url});case 2:response=_context.sent;console.log('Response: ',response.data);console.log('Uploading: ',file);binary=atob(file.split(',')[1]);array=[];for(i=0;i<binary.length;i++){array.push(binary.charCodeAt(i));}blobData=new Blob([new Uint8Array(array)],{type:'text/plain'});console.log('Uploading to: ',response.data.uploadURL);_context.next=12;return fetch(response.data.uploadURL,{method:'PUT',body:blobData});case 12:result=_context.sent;console.log('Result: ',result);// Final URL for the user doesn't need the query string params\nsetUploadUrl(response.data.uploadURL.split('?')[0]);setFile('');case 16:case\"end\":return _context.stop();}}},_callee);}));return function uploadFile(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",{className:classes.content},/*#__PURE__*/React.createElement(Typography,{variant:\"h6\",gutterBottom:true},title),!file?/*#__PURE__*/React.createElement(\"input\",{type:\"file\",onChange:onFileChange}):/*#__PURE__*/React.createElement(\"div\",null,!uploadUrl&&/*#__PURE__*/React.createElement(\"button\",{onClick:removeFile},\"Remove file\"),!uploadUrl&&/*#__PURE__*/React.createElement(\"button\",{onClick:uploadFile},\"Upload file\")));}","map":{"version":3,"sources":["/home/iryna/Desktop/NodeJS-in-AWS-Training/src/components/pages/admin/PageProductImport/components/CSVFileImport.tsx"],"names":["React","useState","makeStyles","Typography","axios","useStyles","theme","content","backgroundColor","palette","background","paper","padding","spacing","CSVFileImport","url","title","classes","file","setFile","uploadUrl","setUploadUrl","createFile","reader","FileReader","onload","e","console","log","target","result","readAsDataURL","onFileChange","files","dataTransfer","length","removeFile","uploadFile","method","response","data","binary","atob","split","array","i","push","charCodeAt","blobData","Blob","Uint8Array","type","uploadURL","fetch","body"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\nimport {makeStyles} from '@material-ui/core/styles';\nimport Typography from \"@material-ui/core/Typography\";\nimport axios from 'axios';\n\nconst useStyles = makeStyles((theme) => ({\n  content: {\n    backgroundColor: theme.palette.background.paper,\n    padding: theme.spacing(3, 0, 3),\n  },\n}));\n\ntype CSVFileImportProps = {\n  url: string,\n  title: string\n};\n\nexport default function CSVFileImport({url, title}: CSVFileImportProps) {\n  const classes = useStyles();\n  const [file, setFile] = useState<any>();\n  const [uploadUrl, setUploadUrl] = useState<any>();\n\n  const createFile = (file: any) => {\n    let reader = new FileReader()\n    reader.onload = (e: any) => {\n      console.log(e.target.result);\n      setFile(e.target.result);\n    }\n    reader.readAsDataURL(file)\n  };\n\n  const onFileChange = (e: any) => {\n    console.log(e);\n    let files = e.target.files || e.dataTransfer.files\n    if (!files.length) return\n    createFile(files[0])\n  };\n\n  const removeFile = () => {\n    setFile('');\n  };\n\n  const uploadFile = async (e: any) => {\n      // Get the presigned URL\n      const response = await axios({\n        method: 'GET',\n        url\n      })\n      console.log('Response: ', response.data)\n      console.log('Uploading: ', file)\n      let binary = atob(file.split(',')[1])\n      let array = []\n      for (var i = 0; i < binary.length; i++) {\n        array.push(binary.charCodeAt(i))\n      }\n      let blobData = new Blob([new Uint8Array(array)], {type: 'text/plain'})\n      console.log('Uploading to: ', response.data.uploadURL)\n      const result = await fetch(response.data.uploadURL, {\n        method: 'PUT',\n        body: blobData\n      })\n      console.log('Result: ', result)\n      // Final URL for the user doesn't need the query string params\n      setUploadUrl(response.data.uploadURL.split('?')[0]);\n      setFile('');\n    }\n  ;\n\n  return (\n    <div className={classes.content}>\n      <Typography variant=\"h6\" gutterBottom>\n        {title}\n      </Typography>\n      {!file ? (\n          <input type=\"file\" onChange={onFileChange}/>\n      ) : (\n        <div>\n          {!uploadUrl && <button onClick={removeFile}>Remove file</button>}\n          {!uploadUrl && <button onClick={uploadFile}>Upload file</button>}\n        </div>\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}